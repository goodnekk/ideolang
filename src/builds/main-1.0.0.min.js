var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var b=[],f=a[Symbol.iterator];if("function"==typeof f)for(a=f.call(a);!(f=a.next()).done;)b.push(c.call(d,f.value));else{f=a.length;for(var g=0;g<f;g++)b.push(c.call(d,a[g]))}return b}},"es6","es3");
var API_ENDPOINT="/api/",controller={find:function(a){m.request({method:"POST",url:API_ENDPOINT+"find",data:{language:viewmodel.language,query:a}}).then(function(a){viewmodel.searchresults=a})},newDesign:function(a){var b=viewmodel.focus;m.request({method:"POST",url:API_ENDPOINT+"design/"+b,data:a}).then(function(a){model.ideograms[b]=a;model.ideograms[b].id=b})},newMeaning:function(a){var b=viewmodel.focus;m.request({method:"POST",url:API_ENDPOINT+"meaning/"+b,data:{language:viewmodel.language,value:a}}).then(function(a){model.ideograms[b]=
a;model.ideograms[b].id=b})},updateMeaning:function(a,b){var c=viewmodel.focus;m.request({method:"POST",url:API_ENDPOINT+"updatemeaning/"+c,data:{language:viewmodel.language,value:a,position:b}}).then(function(a){model.ideograms[c]=a;model.ideograms[c].id=c})},newRelation:function(a){console.log(a);var b=viewmodel.focus;m.request({method:"POST",url:API_ENDPOINT+"related/"+b,data:{related:a}}).then(function(c){model.ideograms[b]=c.a;model.ideograms[b].id=b;model.ideograms[a]=c.b;model.ideograms[a].id=
a})},newIdeogram:function(a){m.request({method:"GET",url:API_ENDPOINT+"new"}).then(function(b){a(b.id)})},loadOverview:function(){m.request({method:"GET",url:API_ENDPOINT+"latest"}).then(function(a){viewmodel.overview=a})},getIdeogram:function(a){void 0===model.ideograms[a]&&(model.ideograms[a]={loading:!0},m.request({method:"GET",url:API_ENDPOINT+"get/"+a}).then(function(b){model.ideograms[a]=b;model.ideograms[a].id=a}));return model.ideograms[a]},navigation:{gotoOverview:function(a){viewmodel.page=
0;viewmodel.search="";controller.loadOverview();a||window.history.pushState("overview","overview","/#!/")},gotoIdeogramDetails:function(a,b){viewmodel.focus=a;viewmodel.page=1;viewmodel.search="";b||window.history.pushState("details","details","/#!/ideogram/"+a)},gotoIdeogramEditor:function(a){viewmodel.focus=a;viewmodel.page=2},gotoAboutPage:function(a){viewmodel.page=3;a||window.history.pushState("about","about","/#!/about/")},loadUrl:function(){var a=window.location.href.split("/#!/");void 0!==
a[1]&&""!==a[1]?(a=a[1].split("/"),"ideogram"===a[0]&&controller.navigation.gotoIdeogramDetails(a[[1]],!0),"about"===a[0]&&controller.navigation.gotoAboutPage(!0)):controller.navigation.gotoOverview(!0);m.redraw()}}};window.onpopstate=function(a){controller.navigation.loadUrl()};
controller.design={pushNewDesign:function(a){a=a||0;a=controller.getIdeogram(viewmodel.focus).ideogram[a];controller.getIdeogram(viewmodel.focus).ideogram.unshift(JSON.parse(JSON.stringify(a)))},popNewDesign:function(){controller.getIdeogram(viewmodel.focus).ideogram.shift()},addPoint:function(a){var b=controller.getIdeogram(viewmodel.focus).ideogram[0];b.points.push(a);return b.points.length-1},movePoint:function(a,b){controller.getIdeogram(viewmodel.focus).ideogram[0].points[a]=b},deletePoint:function(a){var b=
controller.getIdeogram(viewmodel.focus).ideogram[0];b.points.splice(a,1);for(var c=[],d=0;d<b.lines.length;d++){var e=b.lines[d];e[0]!=a&&e[1]!=a&&(e[0]>a&&e[0]--,e[1]>a&&e[1]--,c.push(e))}b.lines=c},addLine:function(a){controller.getIdeogram(viewmodel.focus).ideogram[0].lines.push(a)},removeDoubles:function(){for(var a=controller.getIdeogram(viewmodel.focus).ideogram[0],b=0;b<a.points.length;b++)for(var c=0;c<a.points.length;c++)if(b!=c&&a.points[b][0]==a.points[c][0]&&a.points[b][1]==a.points[c][1]){for(var d in a.lines)a.lines[d][0]==
b&&(a.lines[d][0]=c),a.lines[d][1]==b&&(a.lines[d][1]=c);controller.design.deletePoint(b)}}};function draghandler(a,b){function c(b){console.log("move");a&&a(b);m.redraw()}function d(a){console.log("release");document.removeEventListener("mousemove",c);document.removeEventListener("mouseup",d);b&&b(a)}console.log("down");document.addEventListener("mousemove",c,!1);document.addEventListener("mouseup",d,!1)}
function touchdraghandler(a,b){function c(b){console.log("move");a&&a(b);m.redraw()}function d(a){console.log("release");document.removeEventListener("touchmove",c);document.removeEventListener("touchend",d);b&&b(a)}console.log("down");document.addEventListener("touchmove",c,!1);document.addEventListener("touchend",d,!1)}
var model={ideograms:{},languages:"\u5b98\u8a71;English;Espa\u00f1ol;\u0627\u0644\u0639\u0631\u0628\u064a\u0629 ;\u09ac\u09be\u0982\u09b2\u09be;\u0939\u093f\u0928\u094d\u0926\u0940;\u0420\u0443\u0441\u0441\u043a\u0438\u0439;Portugu\u00eas;\u65e5\u672c\u8a9e;Deutsch;\ud55c\uad6d\uc5b4;Fran\u00e7ais;Ti\u1ebfng Vi\u1ec7t;Italiano;Polski;\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430;\u0641\u0627\u0631\u0633\u06cc;Rom\u00e2n\u0103;Nederlands".split(";")},viewmodel={overview:[],search:"",
searchresults:[],language:"English",focus:void 0,page:0,menu:0,tool:"move"},Editor=function(){return{view:function(a){a=controller.getIdeogram(viewmodel.focus);return m(".editor",[m(".editor-buttons",[m(Button,{type:"move"}),m(Button,{type:"draw"}),m(Button,{type:"delete"})]),m(IdeogramEdit,{gram:a})])}}},Button=function(){return{view:function(a){return m("img.button",{class:viewmodel.tool===a.attrs.type?"selected":"",src:"/buttons/"+a.attrs.type+"Button.png",onclick:function(){viewmodel.tool=a.attrs.type}})}}},
Loading=function(){return{view:function(a){return m(".loading","loading...")}}},About=function(){return{view:function(a){return m(".about",[m("h2","A collaborative, evolving, ideographic language."),m(".about-paragraph","The world has become increasingly complex and interconnected, yet our languages have remained largely separated."),m(".about-paragraph","Ideolang is an attempt to create a universal ideographic language that is open to everyone."),m(".about-paragraph",'The goal is not to create the "ultimate" language, but rather a meta-language that exists inbetween.'),
m(".about-paragraph","It should function much like a pidgin language: a grammatically simplified means of communication that develops between groups that do not have a language in common."),m(".about-paragraph",["Ideolang is being developed as an open source project. If you are interested in helping out please contact: ",m("a",{href:"mailto:ideolang@wolkenmachine.nl"},"ideolang@wolkenmachine.nl")])])}}},Meaning=function(){var a=!1,b="";return{view:function(c){return m(".details-meaning",a?m("input.details-newelement-input",
{value:b,onblur:function(){a=!1},oncreate:function(a){a.dom.focus()},placeholder:c.attrs.placeholder,oninput:function(a){b=a.target.value},onkeypress:function(d){13===d.keyCode&&(c.attrs.onnew(b),b="",a=!1)}}):[c.attrs.meaning,m("span.downvote",{onclick:function(){a=!0;b=c.attrs.meaning}},"edit")])}}},NewMeaning=function(){var a=!1,b="";return{view:function(c){return m(".details-newelement",a?m("input.details-newelement-input",{value:b,onblur:function(){a=!1},oncreate:function(a){a.dom.focus()},placeholder:c.attrs.placeholder,
oninput:function(a){b=a.target.value},onkeypress:function(d){13===d.keyCode&&(c.attrs.onnew(b),b="",a=!1)}}):m(".details-newelement-create",{onclick:function(){a=!0}},c.attrs.message))}}},NewRelation=function(){var a=!1,b="";return{view:function(c){return m(".details-newelement",a?[m("input.details-newelement-input",{value:b,autofocus:!0,oncreate:function(a){a.dom.focus()},placeholder:c.attrs.placeholder,oninput:function(a){b=a.target.value;controller.find(b)},onkeypress:function(c){13===c.keyCode&&
(b="",a=!1)}}),m(".details.newelement-autocomplete",viewmodel.searchresults.map(function(d){var e=controller.getIdeogram(d);return m(".details-newelement-el",{onclick:function(){c.attrs.onnew(d);a=!1;b=""}},[m(Ideogram,{gram:e,size:70}),e.meaning[viewmodel.language]?m(".details-related-meaning",e.meaning[viewmodel.language][0]):[]])}))]:m(".details-newelement-create",{onclick:function(){a=!0}},c.attrs.message))}}},Overview=function(){return{view:function(a){return m(".overview",[""===viewmodel.search?
viewmodel.overview.map(function(a){var b=controller.getIdeogram(a);return b.loading?m(Loading):m(".overview-el",{onclick:function(){controller.navigation.gotoIdeogramDetails(b.id)}},[m(Ideogram,{size:150,gram:b}),b.meaning[viewmodel.language]?m(".overview-meaning",b.meaning[viewmodel.language][0]):[]])}):viewmodel.searchresults.map(function(a){var b=controller.getIdeogram(a);return b.loading?m(Loading):m(".overview-el",{onclick:function(){controller.navigation.gotoIdeogramDetails(b.id)}},[m(Ideogram,
{size:150,gram:b}),b.meaning[viewmodel.language]?m(".overview-meaning",b.meaning[viewmodel.language][0]):[]])})])}}},Details=function(){return{view:function(a){var b=controller.getIdeogram(viewmodel.focus);return b.loading?m(Loading):m(".details",[m(".details-languages",model.languages.map(function(a){return m("div",m("span.details-language",{class:(b.meaning[a]?"details-language-known":"details-language-unknown")+" "+(a===viewmodel.language?"details-language-current":""),onclick:function(){viewmodel.language=
a}},b.meaning[a]?b.meaning[a][0]:a))})),m(".details-current",[m(".details-edit",{class:0===b.ideogram[0].points.length?"empty":"",onclick:function(){controller.design.pushNewDesign();controller.navigation.gotoIdeogramEditor(viewmodel.focus)}},[m("img",{src:"/buttons/drawButton.png"}),m(Ideogram,{gram:b,size:300})]),m(".details-meanings",[b.meaning[viewmodel.language]?[b.meaning[viewmodel.language].map(function(a,b){return m(Meaning,{meaning:a,onnew:function(a){controller.updateMeaning(a,b)}})})]:
[],m(NewMeaning,{id:b.id,message:"+ add meaning",placeholder:"enter new meaning",onnew:controller.newMeaning})]),m(".details-related",b.related.map(function(a){var b=controller.getIdeogram(a);return b.loading?m(Loading):m(".details-related-el",{onclick:function(){controller.navigation.gotoIdeogramDetails(a)}},[m(Ideogram,{gram:b,size:70}),b.meaning[viewmodel.language]?m(".details-related-meaning",b.meaning[viewmodel.language][0]):[]])})),m(NewRelation,{id:b.id,message:"+ add relation",placeholder:"enter new relation",
onnew:controller.newRelation})])])}}},IdeogramEdit=function(){return{view:function(a){function b(a){return Math.round(a)}function c(a,b,c){return(d.points[a[b]][c]+6)*e}var d=a.attrs.gram.ideogram[0],e=1/24*400,f=Array.from({length:23},function(a,b){return b+1-6});return m(".ideogram-editor",{class:"tool-"+viewmodel.tool},[m("svg",{width:400,height:400,onmousedown:function(c){if("draw"===viewmodel.tool){var d=a.dom.getBoundingClientRect();d=[d.x,d.y];c=[c.clientX,c.clientY];var g=controller.design.addPoint([b((c[0]-
d[0])/e-6),b((c[1]-d[1])/e-6)]),f=controller.design.addPoint([b((c[0]-d[0])/e-6),b((c[1]-d[1])/e-6)]);controller.design.addLine([g,f]);draghandler(function(c){var d=a.dom.getBoundingClientRect();d=[d.x,d.y];c=[c.clientX,c.clientY];controller.design.movePoint(f,[b((c[0]-d[0])/e-6),b((c[1]-d[1])/e-6)])})}},onmouseup:function(){controller.design.removeDoubles()},ontouchstart:function(c){c.preventDefault();if("draw"===viewmodel.tool){var d=a.dom.getBoundingClientRect();d=[d.x,d.y];c=[c.touches[0].clientX,
c.touches[0].clientY];var g=controller.design.addPoint([b((c[0]-d[0])/e-6),b((c[1]-d[1])/e-6)]),f=controller.design.addPoint([b((c[0]-d[0])/e-6),b((c[1]-d[1])/e-6)]);controller.design.addLine([g,f]);touchdraghandler(function(c){var d=a.dom.getBoundingClientRect();d=[d.x,d.y];c=[c.touches[0].clientX,c.touches[0].clientY];controller.design.movePoint(f,[b((c[0]-d[0])/e-6),b((c[1]-d[1])/e-6)])})}},ontouchend:function(){controller.design.removeDoubles()}},[m("rect",{x:6*e,y:6*e,width:12*e,height:12*e,
"stroke-width":.5,stroke:"black",fill:"none"}),f.map(function(a){return m("line",{x1:(a+6)*e,y1:0*e,x2:(a+6)*e,y2:24*e,"stroke-width":.1,stroke:"black"})}),f.map(function(a){return m("line",{x1:0*e,y1:(a+6)*e,x2:24*e,y2:(a+6)*e,"stroke-width":.1,stroke:"black"})}),d.lines.map(function(a){if(2===a.length)return m(IdeogramLine,{points:[c(a,0,0),c(a,0,1),c(a,1,0),c(a,1,1)]});if(4===a.length)return m(IdeogramCurve,{points:[c(a,0,0),c(a,0,1),c(a,1,0),c(a,1,1),c(a,2,0),c(a,2,1),c(a,3,0),c(a,3,1)]})}),d.points.map(function(c,
d){return m(IdeogramPoint,{point:[(c[0]+6)*e-3,(c[1]+6)*e-3],ondrag:function(c){if("move"===viewmodel.tool){var f=a.dom.getBoundingClientRect();f=[f.x,f.y];controller.design.movePoint(d,[b((c[0]-f[0])/e-6),b((c[1]-f[1])/e-6)])}},onmouseup:function(){"delete"===viewmodel.tool&&controller.design.deletePoint(d)}})})]),m(".ideogram-word",d.word)])}}},IdeogramPoint=function(){return{view:function(a){var b=a.attrs.point;return m("rect.ideogram-point",{x:b[0],y:b[1],width:6,height:6,onmouseup:function(){a.attrs.onmouseup()},
onmousedown:function(b){b.preventDefault();draghandler(function(b){a.attrs.ondrag([b.clientX,b.clientY])})},ontouchend:function(){a.attrs.onmouseup()},ontouchstart:function(b){b.preventDefault();touchdraghandler(function(b){console.log(b);a.attrs.ondrag([b.touches[0].clientX,b.touches[0].clientY])})}})}}},Ideogram=function(){return{view:function(a){function b(a,b,g){return(c.points[a[b]][g]+2)*d}var c=a.attrs.gram.ideogram[0];a=a.attrs.size||200;var d=1/16*a;Array.from({length:15},function(a,b){return b+
1-2});return m(".ideogram",{class:"size-"+a},[m("svg",{width:a,height:a},[c.lines.map(function(a){if(2===a.length)return m(IdeogramLine,{points:[b(a,0,0),b(a,0,1),b(a,1,0),b(a,1,1)]});if(4===a.length)return m(IdeogramCurve,{points:[b(a,0,0),b(a,0,1),b(a,1,0),b(a,1,1),b(a,2,0),b(a,2,1),b(a,3,0),b(a,3,1)]})})])])}}},IdeogramLine=function(){return{view:function(a){a=a.attrs.points;return m("line.ideogram-line",{x1:a[0],y1:a[1],x2:a[2],y2:a[3]})}}},IdeogramCurve=function(){return{view:function(a){a=a.attrs.points;
return m("path.ideogram-line",{d:"M"+a[0]+" "+a[1]+"C"+a[2]+" "+a[3]+","+a[4]+" "+a[5]+","+a[6]+" "+a[7]})}}},EditorMenu=function(){return{view:function(a){var b=controller.getIdeogram(viewmodel.focus);return m("header",[m("img.header-left",{src:"/buttons/close.png",onclick:function(){controller.design.popNewDesign();controller.navigation.gotoIdeogramDetails(viewmodel.focus)}}),m("h1",b.meaning[viewmodel.language][0]),m(".header-right",{onclick:function(){controller.newDesign(b.ideogram[0]);controller.navigation.gotoIdeogramDetails(viewmodel.focus)}},
"save")])}}},Menu=function(){return{view:function(a){return m("header",[m("h1",{onclick:function(){controller.navigation.gotoOverview()}},"Ideolang"),m("input.header-search",{placeholder:"search",value:viewmodel.search,oninput:function(a){0!==viewmodel.page&&controller.navigation.gotoOverview();viewmodel.search=a.target.value;controller.find(viewmodel.search)}}),m(".header-right",[m("span",{onclick:function(){viewmodel.menu=1}},viewmodel.language),m("span",{onclick:function(){viewmodel.menu=2}},"Menu")]),
1===viewmodel.menu?[m(".popup-back",{onclick:function(){viewmodel.menu=0}}),m(".language-picker",{},model.languages.map(function(a){return m("div",m("span.details-language",{class:a===viewmodel.language?"details-language-current":"",onclick:function(){viewmodel.language=a;viewmodel.menu=0}},a))}))]:[],2===viewmodel.menu?[m(".popup-back",{onclick:function(){viewmodel.menu=0}}),m(".language-picker",{},[m("div",m("span.details-language",{onclick:function(){viewmodel.menu=0;controller.newIdeogram(function(a){controller.navigation.gotoIdeogramDetails(a)})}},
"+ New Ideogram")),m("div",m("span.details-language",{onclick:function(){viewmodel.menu=0;controller.navigation.gotoAboutPage()}},"About Ideolang"))])]:[]])}}},App=function(){return{view:function(a){return[2===viewmodel.page?m(EditorMenu):m(Menu),m(".app",{},[0===viewmodel.page?m(Overview):[],1===viewmodel.page?m(Details):[],2===viewmodel.page?m(Editor):[],3===viewmodel.page?m(About):[]])]}}};m.mount(document.body,App);controller.navigation.loadUrl();